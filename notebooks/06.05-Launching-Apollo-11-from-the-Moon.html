

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6.5. Ascent from Lunar Surface &#8212; ND Pyomo Cookbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/06.05-Launching-Apollo-11-from-the-Moon';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Parameter Estimation" href="07.00-Parameter-Estimation.html" />
    <link rel="prev" title="6.4. Soft Landing Apollo 11 on the Moon" href="06.04-Soft-Landing-Apollo-11-on-the-Moon.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/Kondili_1993.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/Kondili_1993.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    ND Pyomo Cookbook
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="01.00-Getting-Started-with-Pyomo.html">1. Getting Started with Pyomo</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="01.01-Installing-Pyomo.html">1.1. Installing a Pyomo/Python Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.02-Running-Pyomo-on-Google-Colab.html">1.2. Running Pyomo on Google Colab</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.03-Running-Pyomo-on-the-Notre-Dame-CRC-Cluster.html">1.3. Running Pyomo on the Notre Dame CRC Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.04-Cross-Platform-Installation-of-Pyomo-and-Solvers.html">1.4. Cross-Platform Installation of Pyomo and Solvers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="02.00-Linear-Programming.html">2. Linear Programming</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="02.01-Production-Models-with-Linear-Constraints.html">2.1. Production Models with Linear Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.02-Production-Model-Sensitivity-Analysis.html">2.2. Production Model Sensitivity Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.03-Linear-Blending-Problem.html">2.3. Linear Blending Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.04-Mixture-Design-Cold-Weather-Fuel.html">2.4. Design of a Cold Weather Fuel for a Camping Stove</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.05-Gasoline-Blending.html">2.5. Gasoline Blending</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.06-Model-Predictive-Control-of-a-Double-Integrator.html">2.6. Model Predictive Control of a Double Integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.07-Non-Continuous-Objective.html">2.7. Non-Continuous Objectives</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="03.00-Assignment-Problems.html">3. Assignment Problems</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="03.01-Transportation-Networks.html">3.1. Transportation Networks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="04.00-Scheduling-with-Disjunctive-Constraints.html">4. Scheduling with Disjunctive Constraints</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="04.01-Introduction_to_Disjunctive_Programming.html">4.1. Introduction to Disjunctive Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.02-Machine-Bottleneck.html">4.2. Machine Bottleneck</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.03-Job-Shop-Scheduling.html">4.3. Job Shop Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.04-Maintenance-Planning.html">4.4. Maintenance Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.05-Scheduling-Multipurpose-Batch-Processes-using-State-Task_Networks.html">4.5. Scheduling Multipurpose Batch Processes using State-Task Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.06-Unit-Commitment.html">4.6. Unit Commitment</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="05.00-Simulation.html">5. Simulation</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="05.01-Response-of-a-First-Order-System-to-Step-and-Square-Wave-Inputs.html">5.1. Response of a First Order System to Step and Square Wave Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.02-Exothermic-CSTR.html">5.2. Exothermic CSTR</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.03-Heat_Conduction_in_Various_Geometries.html">5.3. Transient Heat Conduction in Various Geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.04-Diffusion_Adsorption_in_Polymers.html">5.4. Diffusion with Adsorption in Polymers</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="06.00-Differential-Algebraic-Equations.html">6. Differential-Algebraic Equations</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="06.01-Unconstrained-Scalar-Optimization.html">6.1. Unconstrained Scalar Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.02-Maximizing-Concentration-of-an-Intermediate-in-a-Batch-Reactor.html">6.2. Maximizing Concentration of an Intermediate in a Batch Reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.03-Path-Planning-for-a-Simple-Car.html">6.3. Path Planning for a Simple Car</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.04-Soft-Landing-Apollo-11-on-the-Moon.html">6.4. Soft Landing Apollo 11 on the Moon</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">6.5. Ascent from Lunar Surface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="07.00-Parameter-Estimation.html">7. Parameter Estimation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="07.01-Parameter-Estimation-Catalytic-Reactor.html">7.1. Parameter estimation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="08.00-Financial-Applications.html">8. Financial Applications</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="08.01-Obtaining-Historical-Stock_-ata.html">8.1. Obtaining Historical Stock Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.02-Consolidating-and-Charting-Stock-Data.html">8.2. Consolidating and Charting Stock Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.03-Binomial-Model-for-Pricing-Options.html">8.3. Binomial Model for Pricing Options</a></li>

<li class="toctree-l2"><a class="reference internal" href="08.04-MAD-Portfolio-Optimization.html">8.5. MAD Portfolio Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.05-Real-Options.html">8.6. Real Options</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="09.00-pyomo-coding-guide.html">9. Guide to Coding with Pyomo</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="09.01-notebook-style-guide.html">9.1. Notebook Style Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">10. Index</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/jckantor/ND-Pyomo-Cookbook/blob/main/notebooks/06.05-Launching-Apollo-11-from-the-Moon.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jckantor/ND-Pyomo-Cookbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jckantor/ND-Pyomo-Cookbook/issues/new?title=Issue%20on%20page%20%2Fnotebooks/06.05-Launching-Apollo-11-from-the-Moon.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/06.05-Launching-Apollo-11-from-the-Moon.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ascent from Lunar Surface</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-formulation">6.5.1. Problem formulation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ascent-from-lunar-surface">
<h1><span class="section-number">6.5. </span>Ascent from Lunar Surface<a class="headerlink" href="#ascent-from-lunar-surface" title="Permalink to this heading">#</a></h1>
<p>Keywords: optimal control, ipopt usage, dae, differential-algebraic equations, rescaling time</p>
<p>In the previous notebook we landed Apollo 11 on the moon. In this notebook we return from the surface of the moon to lunar orbit so that we can rendezvous with the CSM and return home. Of course in this notebook we only consider the launch problem and not the rendezvous problem.</p>
<p>This is a particularly interesting problem to look at because it allows us to compare a direct approach to optimization as used in pyomo against an indirect approach. We will be looking at example 4.5 from Optimal Control with Aerospace Applications by Longuski et al. In Optimal Control the authors take the indirect approach, using the Euler-Lagrange theorem and Pontryagin’s minimum principle to transform the optimization problem into a Boundary Vale Problem (BVP). Here we will use the same problem formulation and solve it using the direct method via pyomo. We will also show the solution via the indirect method but we will not explain the derivation in depth. For that please see Longuski et al.</p>
<section id="problem-formulation">
<h2><span class="section-number">6.5.1. </span>Problem formulation<a class="headerlink" href="#problem-formulation" title="Permalink to this heading">#</a></h2>
<p>We’ll start with the problem formulation which is taken directly from example 4.5 in Optimal Control with Aerospace Applications by Longuski et al.</p>
<p>In the formulation we assume the moon is flat. It’s a bit of a strange model because once we achieve orbital velocity in this model we’ll just fall right back down to the surface, but that’s fine because we’re only interested in what happens up the point of reaching orbital velocity/altitude. Despite the simplicity of the model, it was used in the first stage of the Saturn V launch vehicle.</p>
<p>The image below show a depiction of our formulation. Gravity points in the -y direction, the thrust is referred to as F and our control variable is <span class="math notranslate nohighlight">\(\alpha\)</span></p>
<p><img alt="Flat Planet Model" src="../_images/flat_moon_model.png" /></p>
<p>In this model, as opposed to the previous one, thrust is assumed to be constant and the mass does not vary with time. Longuski et al. do explore models with varying thrust, varying mass, and also atmospheric drag but we leave this to the reader to investigate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyomo.dae</span> <span class="kn">import</span> <span class="n">ContinuousSet</span><span class="p">,</span> <span class="n">DerivativeVar</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">ConcreteModel</span><span class="p">,</span> <span class="n">TransformationFactory</span><span class="p">,</span> <span class="n">Var</span><span class="p">,</span> \
                          <span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">,</span> \
                          <span class="n">SolverFactory</span><span class="p">,</span> <span class="n">Objective</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">minimize</span><span class="p">,</span> \
                          <span class="n">NonNegativeReals</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Define parameters of the problem</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">185.2e3</span> <span class="c1"># meters, final altitude (100 nmi circular orbit)</span>
<span class="n">Vc</span> <span class="o">=</span> <span class="mf">1.627e3</span> <span class="c1"># m/s, Circular speed at 100 nmi</span>
<span class="n">g_accel</span> <span class="o">=</span> <span class="mf">1.62</span> <span class="c1"># m/sˆ2, gravitational acceleration of Moon</span>
<span class="n">Thrust2Weight</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># Thrust to Weight ratio for Ascent Vehicle, in lunar G&#39;s</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">Thrust2Weight</span> <span class="o">*</span> <span class="n">g_accel</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">(</span><span class="s2">&quot;rocket&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">ContinuousSet</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">xdot</span> <span class="o">=</span> <span class="n">DerivativeVar</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">xdoubledot</span> <span class="o">=</span> <span class="n">DerivativeVar</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">xdot</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">ydot</span> <span class="o">=</span> <span class="n">DerivativeVar</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">ydoubledot</span> <span class="o">=</span> <span class="n">DerivativeVar</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ydot</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

<span class="c1"># Dynamics</span>
<span class="n">model</span><span class="o">.</span><span class="n">xode</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">xdoubledot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">yode</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">ydoubledot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">-</span> <span class="n">g_accel</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Boundary conditions at the initial time</span>
<span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">xdot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">ydot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Boundary conditions at the final time</span>
<span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="c1"># Since our velocity state is dx/dtau instead of dx/dt, we must set it to be the final value of dx/dt (which is Vc)</span>
<span class="c1"># multiplied by the final time. Technically ydot needs this as well but fortunately ydotfinal is 0.</span>
<span class="n">model</span><span class="o">.</span><span class="n">xdottf</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Constraint</span><span class="o">.</span><span class="n">Skip</span> <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">last</span><span class="p">()</span> <span class="k">else</span> <span class="n">m</span><span class="o">.</span><span class="n">xdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">Vc</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">ydot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="n">discretizer</span> <span class="o">=</span> <span class="n">TransformationFactory</span><span class="p">(</span><span class="s1">&#39;dae.collocation&#39;</span><span class="p">)</span>
<span class="n">discretizer</span><span class="o">.</span><span class="n">apply_to</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">nfe</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ncp</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="c1"># reduce_collocation_points comes from &quot;pyomo.dae: A Modeling and Automatic Discretization Framework</span>
<span class="c1"># for Optimization with Differential and Algebraic Equations&quot;</span>
<span class="n">discretizer</span><span class="o">.</span><span class="n">reduce_collocation_points</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">ncp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">contset</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="n">tf_direct</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
<span class="n">tdirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">*</span><span class="n">tf_direct</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">alphadirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">xdirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]()</span><span class="o">/</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">ydirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]()</span><span class="o">/</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">xdotdirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">xdot</span><span class="p">[</span><span class="n">t</span><span class="p">]()</span><span class="o">/</span><span class="n">tf_direct</span><span class="o">/</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">ydotdirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ydot</span><span class="p">[</span><span class="n">t</span><span class="p">]()</span><span class="o">/</span><span class="n">tf_direct</span><span class="o">/</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">xdoubledotdirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">xdoubledot</span><span class="p">[</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">ydoubledotdirect</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">ydoubledot</span><span class="p">[</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Optimal Ascent from Flat Moon via Direct Optimization&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">xdirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;x, km&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">322</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">ydirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;y, km&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">323</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">xdotdirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V_x$, km/s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">324</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">ydotdirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V_y$, km/s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">325</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">alphadirect</span><span class="p">),</span> <span class="s1">&#39;b+&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\alpha$, deg&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4de8e3de870cc8244274b8b2f0dda44422487643a291101cdd661ec7c2f8e726.png" src="../_images/4de8e3de870cc8244274b8b2f0dda44422487643a291101cdd661ec7c2f8e726.png" />
</div>
</div>
<p>And now we look at the solution via the indirect approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimal Ascent Problem with Python&#39;s solve_bvp</span>
<span class="c1">#</span>
<span class="c1"># Original script for MATLAB&#39;s bvp4c by by Jose J. Guzman and George E. Pollock</span>
<span class="c1">#</span>
<span class="c1"># Adapted for Python by Nickolai Belakovski</span>
<span class="c1">#</span>
<span class="c1"># This script uses scipy&#39;s solve_bvp to solve the problem of finding the</span>
<span class="c1"># optimal ascent trajectory for launch from a flat Moon to a 100 nautical</span>
<span class="c1"># mile circular orbit.</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_bvp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="c1"># Define parameters of the problem</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">185.2e3</span>  <span class="c1"># meters, final altitude (100 nmi circular orbit)</span>
<span class="n">Vc</span> <span class="o">=</span> <span class="mf">1.627e3</span>  <span class="c1"># m/s, Circular speed at 100 nmi</span>
<span class="n">g_accel</span> <span class="o">=</span> <span class="mf">1.62</span>  <span class="c1"># m/sˆ2, gravitational acceleration of Moon</span>
<span class="n">Thrust2Weight</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Thrust to Weight ratio for Ascent Vehicle, in lunar G&#39;s</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Boundary Conditions</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Initial conditions</span>
<span class="c1"># Launch from zero altitude with zero initial velocity</span>
<span class="n">xi_d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># meters, initial x-position (_d means &#39;desired&#39;)</span>
<span class="n">yi_d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># meters, initial y-position</span>
<span class="n">Vxi_d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># m/s, initial downrange velocity</span>
<span class="n">Vyi_d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># m/s, initial vertical velocity</span>
<span class="c1"># Final conditions</span>
<span class="n">yf_d</span> <span class="o">=</span> <span class="n">h</span>  <span class="c1"># meters, final altitude</span>
<span class="n">Vxf_d</span> <span class="o">=</span> <span class="n">Vc</span>  <span class="c1"># m/s, final downrange velocity</span>
<span class="n">Vyf_d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># m/s, final vertical velocity</span>
<span class="n">Hf_d</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>


<span class="c1"># Note: this function uses g_accel and Thrust2Weight and so must be defined</span>
<span class="c1"># after those two variables</span>
<span class="k">def</span> <span class="nf">ascent_odes_tf</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># State and Costate Differential Equation Function for the Flat-Moon</span>
    <span class="c1"># Optimal Ascent Problem</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># The independent variable here is the nondimensional time, tau, the state</span>
    <span class="c1"># vector is X, and the final time, tf, is an unknown parameter that must</span>
    <span class="c1"># also be passed to the DE function.</span>
    <span class="c1"># Note that the state vector X has components</span>
    <span class="c1"># X[0] = x, horizontal component of position</span>
    <span class="c1"># X[1] = y, vertical component of position</span>
    <span class="c1"># X[2] = Vx, horizontal component of velocity</span>
    <span class="c1"># X[3] = Vy, vertical component of velocity</span>
    <span class="c1"># X[4] = lambda2</span>
    <span class="c1"># X[5] = lambda3</span>
    <span class="c1"># X[6] = lambda4</span>
    <span class="c1"># Acceleration (F/m) of the Ascent Vehicle, m/s^2</span>
    <span class="n">Acc</span> <span class="o">=</span> <span class="n">Thrust2Weight</span><span class="o">*</span><span class="n">g_accel</span>
    <span class="c1"># State and Costate differential equations in terms of d/dt:</span>
    <span class="c1"># x and y are unused but we label them anyway for completeness and also debugging</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># noqa</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># noqa</span>
    <span class="n">Vx</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Vy</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">lambda2</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">lambda3</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">lambda4</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">xdot</span> <span class="o">=</span> <span class="n">Vx</span>
    <span class="n">ydot</span> <span class="o">=</span> <span class="n">Vy</span>
    <span class="n">Vxdot</span> <span class="o">=</span> <span class="n">Acc</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">lambda3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda3</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lambda4</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">Vydot</span> <span class="o">=</span> <span class="n">Acc</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">lambda4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda3</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lambda4</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">g_accel</span>
    <span class="n">lambda2_dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">lambda3_dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">lambda4_dot</span> <span class="o">=</span> <span class="o">-</span><span class="n">lambda2</span>
    <span class="c1"># Nondimensionalize time (with tau = t/tf and d/dtau = tf*d/dt). We must</span>
    <span class="c1"># multiply each differential equation by tf to convert our derivatives from</span>
    <span class="c1"># d/dt to d/dtau.</span>
    <span class="n">dX_dtau</span> <span class="o">=</span> <span class="n">tf</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xdot</span><span class="p">,</span> <span class="n">ydot</span><span class="p">,</span> <span class="n">Vxdot</span><span class="p">,</span> <span class="n">Vydot</span><span class="p">,</span> <span class="n">lambda2_dot</span><span class="p">,</span> <span class="n">lambda3_dot</span><span class="p">,</span> <span class="n">lambda4_dot</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dX_dtau</span>


<span class="c1"># Note: this function uses the initial and final boundary conditions and so</span>
<span class="c1"># must be defined after those variables are defined</span>
<span class="k">def</span> <span class="nf">ascent_bcs_tf</span><span class="p">(</span><span class="n">Y0</span><span class="p">,</span> <span class="n">Yf</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
    <span class="c1"># Boundary Condition Function for the Flat-Moon Optimal Ascent Problem</span>
    <span class="c1"># Hamiltonian final needs to be -1</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Vxi</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Vyi</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">lambda2i</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># noqa</span>
    <span class="n">lambda3i</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># noqa</span>
    <span class="n">lambda4i</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># noqa</span>

    <span class="n">xf</span> <span class="o">=</span> <span class="n">Yf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># noqa</span>
    <span class="n">yf</span> <span class="o">=</span> <span class="n">Yf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Vxf</span> <span class="o">=</span> <span class="n">Yf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Vyf</span> <span class="o">=</span> <span class="n">Yf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">lambda2f</span> <span class="o">=</span> <span class="n">Yf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">lambda3f</span> <span class="o">=</span> <span class="n">Yf</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">lambda4f</span> <span class="o">=</span> <span class="n">Yf</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

    <span class="n">costhetaf</span> <span class="o">=</span> <span class="o">-</span><span class="n">lambda3f</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda3f</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lambda4f</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sinthetaf</span> <span class="o">=</span> <span class="o">-</span><span class="n">lambda4f</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda3f</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lambda4f</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Acc</span> <span class="o">=</span> <span class="n">Thrust2Weight</span><span class="o">*</span><span class="n">g_accel</span>
    <span class="n">Hf</span> <span class="o">=</span> <span class="n">lambda2f</span><span class="o">*</span><span class="n">Vxf</span> <span class="o">+</span> <span class="n">lambda3f</span> <span class="o">*</span> <span class="n">Acc</span> <span class="o">*</span> <span class="n">costhetaf</span> <span class="o">+</span> <span class="n">lambda4f</span> <span class="o">*</span> <span class="n">Acc</span> <span class="o">*</span> <span class="n">sinthetaf</span> <span class="o">-</span> <span class="n">lambda4f</span><span class="o">*</span><span class="n">g_accel</span>
    <span class="n">PSI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">xi</span> <span class="o">-</span> <span class="n">xi_d</span><span class="p">,</span>
        <span class="n">yi</span> <span class="o">-</span> <span class="n">yi_d</span><span class="p">,</span>
        <span class="n">Vxi</span> <span class="o">-</span> <span class="n">Vxi_d</span><span class="p">,</span>
        <span class="n">Vyi</span> <span class="o">-</span> <span class="n">Vyi_d</span><span class="p">,</span>
        <span class="n">yf</span> <span class="o">-</span> <span class="n">yf_d</span><span class="p">,</span>
        <span class="n">Vxf</span> <span class="o">-</span> <span class="n">Vxf_d</span><span class="p">,</span>
        <span class="n">Vyf</span> <span class="o">-</span> <span class="n">Vyf_d</span><span class="p">,</span>
        <span class="n">Hf</span> <span class="o">-</span> <span class="n">Hf_d</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">PSI</span>


<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Initial Guesses</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># list initial conditions in yinit, use zero if unknown</span>
<span class="n">yinit</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi_d</span><span class="p">,</span> <span class="n">yi_d</span><span class="p">,</span> <span class="n">Vxi_d</span><span class="p">,</span> <span class="n">Vyi_d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># guess for initial state and costate variables</span>
<span class="n">tf_guess</span> <span class="o">=</span> <span class="mi">700</span>  <span class="c1"># sec, initial guess for final time</span>

<span class="c1"># Because the final time is free, we must parameterize the problem by</span>
<span class="c1"># the unknown final time, tf. Create a nondimensional time vector,</span>
<span class="c1"># tau, with Nt linearly spaced elements. (tau = time/tf) We will pass the</span>
<span class="c1"># unknown final time to solve_bvp as an unknown parameter and the code will</span>
<span class="c1"># attempt to solve for the actual final time as it solves our TPBVP.</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="mi">41</span>
<span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nt</span><span class="p">)</span>  <span class="c1"># nondimensional time vector</span>
<span class="c1"># Create an initial guess of the solution. For some BVPs it can be useful to ensure</span>
<span class="c1"># that the initial guess satisfies both the initial and final boundary conditions</span>
<span class="c1"># but for this problem we can simply copy the initial states across the time mesh</span>
<span class="c1"># because it&#39;s not too sensitive to the initial guess</span>
<span class="n">solinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">yinit</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Solution</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_bvp</span><span class="p">(</span><span class="n">ascent_odes_tf</span><span class="p">,</span> <span class="n">ascent_bcs_tf</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">solinit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tf_guess</span><span class="p">]))</span>
<span class="c1"># Extract the final time from the solution:</span>
<span class="n">tf_indirect</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Evaluate the solution at all times in the nondimensional time vector tau</span>
<span class="c1"># and store the state variables in the matrix Z.</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">sol</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
<span class="c1"># Convert back to dimensional time for plotting</span>
<span class="n">tindirect</span> <span class="o">=</span> <span class="n">tau</span><span class="o">*</span><span class="n">tf_indirect</span>
<span class="c1"># Extract the solution for each state variable from the matrix Z:</span>
<span class="n">xindirect</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">yindirect</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">xdotindirect</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">ydotindirect</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">lambda2_sol</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">lambda3_sol</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">lambda4_sol</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">alphaindirect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">lambda4_sol</span><span class="p">,</span> <span class="o">-</span><span class="n">lambda3_sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Optimal Ascent from Flat Moon via Inirect Optimization&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">xindirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;x, km&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">322</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">yindirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;y, km&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">323</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">xdotindirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V_x$, km/s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">324</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">ydotindirect</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V_y$, km/s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">325</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">alphaindirect</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\alpha$, deg&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5c24acce7bc1a3644bae01ae8e87b6cdd6d426b3af8383f55c8be3125df19f3e.png" src="../_images/5c24acce7bc1a3644bae01ae8e87b6cdd6d426b3af8383f55c8be3125df19f3e.png" />
</div>
</div>
<p>Finally, we compare the two solutions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="c1"># We&#39;ll consider the indirect approach to be the &quot;true&quot; solution</span>
<span class="c1"># It&#39;s not exactly analytical since we had to use a numerical BVP</span>
<span class="c1"># solver to obtain the solution, but given the fact that it is the</span>
<span class="c1"># optimal BVP to solve it is fair to use it as truth</span>
<span class="n">tf_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">tf_direct</span> <span class="o">-</span> <span class="n">tf_indirect</span><span class="p">)</span><span class="o">/</span><span class="n">tf_indirect</span><span class="o">*</span><span class="mi">100</span>

<span class="c1"># To compare simulation parameters we interpolate both solutions</span>
<span class="n">xdirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">xdirect</span><span class="p">)</span>
<span class="n">ydirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">ydirect</span><span class="p">)</span>
<span class="n">xdotdirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">xdotdirect</span><span class="p">)</span>
<span class="n">ydotdirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">ydotdirect</span><span class="p">)</span>
<span class="n">alphadirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tdirect</span><span class="p">,</span> <span class="n">alphadirect</span><span class="p">)</span>

<span class="n">xindirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">xindirect</span><span class="p">)</span>
<span class="n">yindirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">yindirect</span><span class="p">)</span>
<span class="n">xdotindirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">xdotindirect</span><span class="p">)</span>
<span class="n">ydotindirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">ydotindirect</span><span class="p">)</span>
<span class="n">alphaindirectinterp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tindirect</span><span class="p">,</span> <span class="n">alphaindirect</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Percent error in final time:&quot;</span><span class="p">,</span> <span class="n">tf_err</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tf_direct: </span><span class="si">{</span><span class="n">tf_direct</span><span class="si">}</span><span class="s2">, tf_indirect: </span><span class="si">{</span><span class="n">tf_indirect</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">teval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">tf_direct</span><span class="p">,</span> <span class="n">tf_indirect</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">errx</span> <span class="o">=</span> <span class="n">xindirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span> <span class="o">-</span> <span class="n">xdirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span>
<span class="n">erry</span> <span class="o">=</span> <span class="n">yindirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span> <span class="o">-</span> <span class="n">ydirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span>
<span class="n">errxdot</span> <span class="o">=</span> <span class="n">xdotindirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span> <span class="o">-</span> <span class="n">xdotdirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span>
<span class="n">errydot</span> <span class="o">=</span> <span class="n">ydotindirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span> <span class="o">-</span> <span class="n">ydotdirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span>
<span class="n">erralpha</span> <span class="o">=</span> <span class="n">alphaindirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span> <span class="o">-</span> <span class="n">alphadirectinterp</span><span class="p">(</span><span class="n">teval</span><span class="p">)</span>
<span class="n">erralpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># We override the initial error to scale the graph appropraites</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Optimal Ascent from Flat Moon via Inirect Optimization&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teval</span><span class="p">,</span> <span class="n">errx</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$err_x$, km&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">322</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teval</span><span class="p">,</span> <span class="n">erry</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$err_y$, km&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">323</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teval</span><span class="p">,</span> <span class="n">errxdot</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$err_</span><span class="si">{V_x}</span><span class="s1">$, km/s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">324</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teval</span><span class="p">,</span> <span class="n">errydot</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$err_</span><span class="si">{V_y}</span><span class="s1">$, km/s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">325</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teval</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">erralpha</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$err_{\alpha}$, deg&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, sec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Percent error in final time: 0.01581866075745914 %
tf_direct: 481.2800616637531, tf_indirect: 481.2039416446728
</pre></div>
</div>
<img alt="../_images/05b7626020e9e60b48e0317dcfaee135f3daf02d003acbb0adf7c11dacee3dd1.png" src="../_images/05b7626020e9e60b48e0317dcfaee135f3daf02d003acbb0adf7c11dacee3dd1.png" />
</div>
</div>
<p>The difference in final time is negligible.</p>
<p>We see that the difference in the control angle <span class="math notranslate nohighlight">\(\alpha\)</span> gets up to 2.5 degrees, and we have ignored the initial value where the direct approach chose to keep it at 0. The result is that the difference in downrange distance gets to be over 100 meters, but in the other 3 variables, which are more important to us as we set boundary conditions on those (we may care about downrange distance for the rendezvous case but we’re not concerned with it here), we see rather small errors.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="06.04-Soft-Landing-Apollo-11-on-the-Moon.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">6.4. </span>Soft Landing Apollo 11 on the Moon</p>
      </div>
    </a>
    <a class="right-next"
       href="07.00-Parameter-Estimation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Parameter Estimation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-formulation">6.5.1. Problem formulation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeffrey C. Kantor
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>