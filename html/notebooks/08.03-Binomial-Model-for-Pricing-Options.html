
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8.3. Binomial Model for Pricing Options &#8212; ND Pyomo Cookbook</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8.5. MAD Portfolio Optimization" href="08.04-MAD-Portfolio-Optimization.html" />
    <link rel="prev" title="8.2. Consolidating and Charting Stock Data" href="08.02-Consolidating-and-Charting-Stock-Data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/Kondili_1993.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ND Pyomo Cookbook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    ND Pyomo Cookbook
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="01.00-Getting-Started-with-Pyomo.html">
   1. Getting Started with Pyomo
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="01.01-Installing-Pyomo.html">
     1.3. Installing a Pyomo/Python Development Environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.02-Running-Pyomo-on-Google-Colab.html">
     1.4. Running Pyomo on Google Colab
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.03-Running-Pyomo-on-the-Notre-Dame-CRC-Cluster.html">
     1.5. Running Pyomo on the Notre Dame CRC Cluster
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.04-Cross-Platform-Installation-of-Pyomo-and-Solvers.html">
     1.6. Cross-Platform Installation of Pyomo and Solvers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="02.00-Linear-Programming.html">
   2. Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02.01-Production-Models-with-Linear-Constraints.html">
     2.1. Production Models with Linear Constraints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.02-Production-Model-Sensitivity-Analysis.html">
     2.2. Production Model Sensitivity Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.03-Linear-Blending-Problem.html">
     2.3. Linear Blending Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.04-Mixture-Design-Cold-Weather-Fuel.html">
     2.4. Design of a Cold Weather Fuel for a Camping Stove
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.05-Gasoline-Blending.html">
     2.5. Gasoline Blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.06-Model-Predictive-Control-of-a-Double-Integrator.html">
     2.6. Model Predictive Control of a Double Integrator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.07-Non-Continuous-Objective.html">
     2.7. Non-Continuous Objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03.00-Assignment-Problems.html">
   3. Assignment Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="03.01-Transportation-Networks.html">
     3.1. Transportation Networks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="04.00-Scheduling-with-Disjunctive-Constraints.html">
   4. Scheduling with Disjunctive Constraints
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04.01-Introduction_to_Disjunctive_Programming.html">
     4.1. Introduction to Disjunctive Programming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.02-Machine-Bottleneck.html">
     4.2. Machine Bottleneck
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.03-Job-Shop-Scheduling.html">
     4.3. Job Shop Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.04-Maintenance-Planning.html">
     4.4. Maintenance Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.05-Scheduling-Multipurpose-Batch-Processes-using-State-Task_Networks.html">
     4.5. Scheduling Multipurpose Batch Processes using State-Task Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.06-Unit-Commitment.html">
     4.6. Unit Commitment
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="05.00-Simulation.html">
   5. Simulation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="05.01-Response-of-a-First-Order-System-to-Step-and-Square-Wave-Inputs.html">
     5.1. Response of a First Order System to Step and Square Wave Inputs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.02-Exothermic-CSTR.html">
     5.2. Exothermic CSTR
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.03-Heat_Conduction_in_Various_Geometries.html">
     5.3. Transient Heat Conduction in Various Geometries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.04-Diffusion_Adsorption_in_Polymers.html">
     5.4. Diffusion with Adsorption in Polymers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06.00-Differential-Algebraic-Equations.html">
   6. Differential-Algebraic Equations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06.01-Unconstrained-Scalar-Optimization.html">
     6.1. Unconstrained Scalar Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.02-Maximizing-Concentration-of-an-Intermediate-in-a-Batch-Reactor.html">
     6.2. Maximizing Concentration of an Intermediate in a Batch Reactor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.03-Path-Planning-for-a-Simple-Car.html">
     6.3. Path Planning for a Simple Car
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.04-Soft-Landing-Apollo-11-on-the-Moon.html">
     6.4. Soft Landing Apollo 11 on the Moon
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.05-Launching-Apollo-11-from-the-Moon.html">
     6.5. Ascent from Lunar Surface
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="07.00-Parameter-Estimation.html">
   7. Parameter Estimation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="07.01-Parameter-Estimation-Catalytic-Reactor.html">
     7.1. Parameter estimation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="08.00-Financial-Applications.html">
   8. Financial Applications
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="08.01-Obtaining-Historical-Stock_-ata.html">
     8.1. Obtaining Historical Stock Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.02-Consolidating-and-Charting-Stock-Data.html">
     8.2. Consolidating and Charting Stock Data
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     8.3. Binomial Model for Pricing Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.04-MAD-Portfolio-Optimization.html">
     8.5. MAD Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08.05-Real-Options.html">
     8.6. Real Options
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="09.00-pyomo-coding-guide.html">
   9. Guide to Coding with Pyomo
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="09.01-notebook-style-guide.html">
     9.1. Notebook Style Guide
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../genindex.html">
   10. Index
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jckantor/ND-Pyomo-Cookbook/main?urlpath=tree/notebooks/08.03-Binomial-Model-for-Pricing-Options.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/jckantor/ND-Pyomo-Cookbook/blob/main/notebooks/08.03-Binomial-Model-for-Pricing-Options.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jckantor/ND-Pyomo-Cookbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jckantor/ND-Pyomo-Cookbook/issues/new?title=Issue%20on%20page%20%2Fnotebooks/08.03-Binomial-Model-for-Pricing-Options.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/08.03-Binomial-Model-for-Pricing-Options.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   8.3. Binomial Model for Pricing Options
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     8.3.1. Imports
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#historical-data">
     8.3.2. Historical data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trim-data-series">
       8.3.2.1. Trim data series
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fitting-historical-data-to-geometric-brownian-motion">
   8.4. Fitting historical data to geometric Brownian motion
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binomial-model">
     8.4.1. Binomial model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#european-call-option">
     8.4.2. European call option
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-a-replicating-portfolio-with-pyomo">
     8.4.3. Implementing a replicating portfolio with Pyomo
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#european-put-option">
     8.4.4. European put option
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#early-exercise">
     8.4.5. Early exercise
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#american-put-option">
     8.4.6. American put option
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Binomial Model for Pricing Options</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   8.3. Binomial Model for Pricing Options
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     8.3.1. Imports
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#historical-data">
     8.3.2. Historical data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trim-data-series">
       8.3.2.1. Trim data series
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fitting-historical-data-to-geometric-brownian-motion">
   8.4. Fitting historical data to geometric Brownian motion
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binomial-model">
     8.4.1. Binomial model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#european-call-option">
     8.4.2. European call option
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-a-replicating-portfolio-with-pyomo">
     8.4.3. Implementing a replicating portfolio with Pyomo
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#european-put-option">
     8.4.4. European put option
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#early-exercise">
     8.4.5. Early exercise
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#american-put-option">
     8.4.6. American put option
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="binomial-model-for-pricing-options">
<h1><span class="section-number">8.3. </span>Binomial Model for Pricing Options<a class="headerlink" href="#binomial-model-for-pricing-options" title="Permalink to this headline">#</a></h1>
<p>Keywords: glpk usage, option pricing, binomial model</p>
<p>This notebooks demonstrates techniques for pricing options using a binomial lattice to model prices of the underlying security or commodity. The notebook makes use of the pandas_datareader library to download pricing information, and the Pyomo modeling library for some example calculations.</p>
<section id="imports">
<h2><span class="section-number">8.3.1. </span>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pyomo&quot;</span><span class="p">):</span>
    <span class="o">!</span>pip install -q pyomo
    <span class="k">assert</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pyomo&quot;</span><span class="p">))</span>

<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;glpsol&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;glpsol&quot;</span><span class="p">)):</span>
    <span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="o">!</span>apt-get install -y -qq glpk-utils
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="o">!</span>conda install -c conda-forge glpk 
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">assert</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;glpsol&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;glpsol&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="historical-data">
<h2><span class="section-number">8.3.2. </span>Historical data<a class="headerlink" href="#historical-data" title="Permalink to this headline">#</a></h2>
<p>The first step is download historical data for a selected security or commodity.  For the purposes of this notebook, it is useful to choose security of commodities for which there is an active options trading so the pricing model can be compared to real data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/jckantor/ND-Pyomo-Cookbook/master/notebooks/data/Historical_Adjusted_Close.csv&quot;</span>
<span class="n">S_hist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">S_hist</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Adjusted Close&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_4_0.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_4_0.png" />
</div>
</div>
<section id="trim-data-series">
<h3><span class="section-number">8.3.2.1. </span>Trim data series<a class="headerlink" href="#trim-data-series" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nYears</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">S_hist</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">nYears</span><span class="o">*</span><span class="mi">252</span><span class="p">:]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Adjusted Close&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_6_0.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_6_0.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="fitting-historical-data-to-geometric-brownian-motion">
<h1><span class="section-number">8.4. </span>Fitting historical data to geometric Brownian motion<a class="headerlink" href="#fitting-historical-data-to-geometric-brownian-motion" title="Permalink to this headline">#</a></h1>
<p>A model for Geometric Brownian Motion can be written in discrete time as</p>
<div class="math notranslate nohighlight">
\[S_{t + \Delta t} = S_t + \mu S_t \Delta t + \sigma S_t \sqrt{\Delta t} Z_t \]</div>
<p>where <span class="math notranslate nohighlight">\(Z_t\)</span> is a normal random variate with zero mean and a standard deviation of one. This could also be written as</p>
<div class="math notranslate nohighlight">
\[ \ln S_{t + \Delta t} = \ln S_t + \nu \Delta t + \sigma \sqrt{\Delta t} Z_t \]</div>
<p>where <span class="math notranslate nohighlight">\(\nu = \mu -\frac{\sigma^2}{2}\)</span>. These are two different models for price. The difference between <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\nu\)</span>, i.e.  <span class="math notranslate nohighlight">\(\frac{\sigma^2}{2}\)</span>, is referred to as ‘volatility drag.’</p>
<p>Rearranging each of these models</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
r^{lin} &amp; = \frac{S_{t+\Delta t} - S_t}{S_t} = \mu\Delta t + \sigma \sqrt{\Delta t}Z_t \sim \cal{N}(\mu\Delta t, \sigma^2\Delta t)\\
r^{log} &amp; = \ln S_{t+\Delta t} - \ln S_t = \nu\Delta t + \sigma \sqrt{\Delta t}Z_t \sim \cal{N}(\nu\Delta t,\sigma^2\Delta t)\\
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\cal{N}(\alpha,\beta)\)</span> denotes the normal distribution with mean <span class="math notranslate nohighlight">\(\alpha\)</span> and variance <span class="math notranslate nohighlight">\(\beta\)</span> (i.e., standard deviation <span class="math notranslate nohighlight">\(\sqrt{\beta}\)</span>).</p>
<p>The parameters can be estimated from trading data as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\hat{\mu} &amp; = \frac{1}{\Delta t} \mbox{mean}(\frac{S_{t+\Delta t} - S_t}{S_t}) \\
\hat{\nu} &amp; = \frac{1}{\Delta t} \mbox{mean}(\ln S_{t+\Delta t} - \ln S_t) \\
\hat{\sigma} &amp; = \frac{1}{\sqrt{\Delta t}} \mbox{stdev}(\frac{S_{t+\Delta t} - S_t}{S_t}) \approx  \frac{1}{\sqrt{\Delta t}} \mbox{stdev}(\ln S_{t+\Delta t} - \ln S_t)
\end{align*}
\end{split}\]</div>
<p>Note that for trading data time is measured in ‘trading days’. On average there are 252 trading days in a year.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Period</p></th>
<th class="text-align:center head"><p>Trading Days</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Year</p></td>
<td class="text-align:center"><p>252</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Quarter</p></td>
<td class="text-align:center"><p>63</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Month</p></td>
<td class="text-align:center"><p>21</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Weekly</p></td>
<td class="text-align:center"><p>4.83</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Calendar Day</p></td>
<td class="text-align:center"><p>0.690</p></td>
</tr>
</tbody>
</table>
<p>Using these data and the above formulae, <span class="math notranslate nohighlight">\(\mu\)</span>, <span class="math notranslate nohighlight">\(\nu\)</span>, and <span class="math notranslate nohighlight">\(\sigma\)</span> can be rescaled to other units of time. For example, if these are estimated from daily trading data, then on an annualized basis</p>
<p>\begin{align*}
\mu^{annual} &amp; = 252 \times \mu^{trading\ day} \
\nu^{annual} &amp; = 252 \times \nu^{trading\ day} \
\sigma^{annual} &amp; = \sqrt{252} \times \sigma^{trading\ day} \
\end{align*}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute linear and log returns</span>
<span class="n">rlin</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">S</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rlog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">S</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">rlin</span> <span class="o">=</span> <span class="n">rlin</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">rlog</span> <span class="o">=</span> <span class="n">rlog</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># plot data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rlin</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Linear Returns (daily)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rlog</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Log Returns (daily)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Linear Returns&#39;</span><span class="p">)</span>
<span class="n">mu</span><span class="p">,</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rlin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   mu = </span><span class="si">{0:12.8f}</span><span class="s1">  (annualized = </span><span class="si">{1:.2f}</span><span class="s1">%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="mi">252</span><span class="o">*</span><span class="n">mu</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sigma = </span><span class="si">{0:12.8f}</span><span class="s1">  (annualized = </span><span class="si">{1:.2f}</span><span class="s1">%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Log Returns&#39;</span><span class="p">)</span>
<span class="n">nu</span><span class="p">,</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rlog</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   nu = </span><span class="si">{0:12.8f}</span><span class="s1">  (annualized = </span><span class="si">{1:.2f}</span><span class="s1">%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="mi">252</span><span class="o">*</span><span class="n">nu</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sigma = </span><span class="si">{0:12.8f}</span><span class="s1">  (annualized = </span><span class="si">{1:.2f}</span><span class="s1">%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linear Returns
   mu =   0.00092417  (annualized = 23.29%)
sigma =   0.01511914  (annualized = 24.00%)

Log Returns
   nu =   0.00080934  (annualized = 20.40%)
sigma =   0.01513892  (annualized = 24.03%)
</pre></div>
</div>
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_8_1.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_8_1.png" />
</div>
</div>
<section id="binomial-model">
<h2><span class="section-number">8.4.1. </span>Binomial model<a class="headerlink" href="#binomial-model" title="Permalink to this headline">#</a></h2>
<p>The binomial model provides a means of modeling the statistical distribution of future prices. Given a current price <span class="math notranslate nohighlight">\(S_t\)</span>, there are two possible states for the next observed value <span class="math notranslate nohighlight">\(S_{t+\Delta t}\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}S_{t + \Delta t} = \begin{cases} u S_t &amp; \mbox{with probability } p \\ d S_t &amp; \mbox{with probability } 1-p\end{cases}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(u\)</span>, <span class="math notranslate nohighlight">\(d\)</span>, and <span class="math notranslate nohighlight">\(p\)</span> are chosen to match the statistics of a model based on Geometric Brownian Motion.
The following parameter values are derived in <a class="reference external" href="https://global.oup.com/ushe/product/investment-science-9780199740086?cc=us&amp;lang=en&amp;">Luenberger (2013)</a>,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
p &amp; = \frac{1}{2} + \frac{\nu\Delta t}{2\sqrt{\sigma^2\Delta t + (\nu\Delta t)^2}} \\
\ln u &amp; = \sqrt{\sigma^2\Delta t + (\nu\Delta t)^2} \\
\ln d &amp; = - \sqrt{\sigma^2\Delta t + (\nu\Delta t)^2} 
\end{align*}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time/period</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mi">21</span>

<span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">nu</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">nu</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">nu</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">nu</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probability (p) = &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Up Return (u) = &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Down Return (d) = &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Probability (p) =  0.619
  Up Return (u) =  1.074
Down Return (d) =  0.9311
</pre></div>
</div>
</div>
</div>
<p>The model extends to multiple time steps in a natural way as shown in this diagram:</p>
<p><img alt="BinomialModel.png" src="https://github.com/jckantor/ND-Pyomo-Cookbook/blob/master/notebooks/figures/BinomialModel.png?raw=1" /></p>
<p>Note that each step forward in time introduces an additional state to the set of possible outcomes.</p>
<p>For the purpose of coding, we will use Python dictionaries to store future prices <span class="math notranslate nohighlight">\(S^f\)</span>. Future prices are indexed by two subscripts, <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(s\)</span>, such that <code class="docutils literal notranslate"><span class="pre">Sf[k,s]</span></code> corresponds to the price at time <span class="math notranslate nohighlight">\(t + k\Delta t\)</span> in state <span class="math notranslate nohighlight">\(s\)</span>.</p>
<p>We start by setting the initial node equal to the last observed price, <span class="math notranslate nohighlight">\(S^f_{0,0} = S_t\)</span>. For each <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(s\)</span> there are two subsequent nodes</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
S^f_{k + 1, s} &amp; = u S^f_{k,s} \\
S^f_{k + 1, s + 1} &amp; = d S^f_{k,s}
\end{align*}
\end{split}\]</div>
<p>These two equations can be combined by eliminating the common term <span class="math notranslate nohighlight">\(S^f_{k,s}\)</span> to yield</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
S^f_{k + 1, s} &amp; = u S^f_{k,s} \\
S^f_{k+1,s+1} &amp; = \frac{d}{u} S^f_{k+1,s}
\end{align*}
\end{split}\]</div>
<p>These formula can be solved explicit to give</p>
<div class="math notranslate nohighlight">
\[S^f_{k,s} = u^{k-s}d^{s}S^f_{0,0}\]</div>
<p>which is the formula used below to compute values in the binomial lattice.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># initialize Sf</span>
<span class="n">Sf</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Sf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># compute values</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="n">s</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
      
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="k">def</span> <span class="nf">Sdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">Sf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="s1">&#39;   </span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]),</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]],</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    
<span class="n">Sdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_12_0.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_12_0.png" />
</div>
</div>
<p>The probability of reaching state <span class="math notranslate nohighlight">\(s\)</span> at time step <span class="math notranslate nohighlight">\(k\)</span> is denoted by <span class="math notranslate nohighlight">\(P_{k,s}\)</span>. This can be computed given probability of preceding states and the conditional probabilities <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(1-p\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
P_{k,s} &amp; = p P_{k-1,s} + (1-p) P_{k-1,s-1}
\end{align*}
\]</div>
<p>The following cell evaluates price and probability for a binomial model, and also plot the average price.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="k">def</span> <span class="nf">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">D</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">nPeriods</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">Sf</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">Sfmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Sfvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">Sf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">Sfmean</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span>
        <span class="n">Sfvar</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">],</span><span class="s1">&#39;   </span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]),</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Sfmean</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">Sfstdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Sfvar</span> <span class="o">-</span> <span class="n">Sfmean</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Sfmean</span> <span class="o">+</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">Sfstdev</span><span class="p">,</span><span class="s1">&#39;g--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Sfmean</span> <span class="o">-</span> <span class="mf">1.96</span><span class="o">*</span><span class="n">Sfstdev</span><span class="p">,</span><span class="s1">&#39;g--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Probability Projection with 95</span><span class="si">% c</span><span class="s1">onfidence interval&#39;</span><span class="p">)</span>
<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_14_0.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_14_0.png" />
</div>
</div>
</section>
<section id="european-call-option">
<h2><span class="section-number">8.4.2. </span>European call option<a class="headerlink" href="#european-call-option" title="Permalink to this headline">#</a></h2>
<p>A European Call Option is a contract the provides the holder with the right, but not the obligation, to purchase an asset at a specified price and date in the future. The specified price is generally called the <strong>strike price</strong>, and the specified date is the <strong>expiration date</strong>.</p>
<p>The purpose of the call option is to reduce the holder’s exposure to the risk of increasing prices. An airline, for example, might choose to purchase call options on airplane fuels in order to reduce the risk of selling advance tickets.</p>
<p>The value of the call option upon expiration depends on the price of underlying asset. If the asset spot price <span class="math notranslate nohighlight">\(S\)</span> is greater than the strike price <span class="math notranslate nohighlight">\(K\)</span>, then the call option is worth the difference <span class="math notranslate nohighlight">\(S-K\)</span> because that is amount needed to fulfill the contract in the spot market.</p>
<p>On the other hand, if the asset price falls below the strike price, then the option contract has no value since the holder could buy the asset on the spot market for less than the strike price.</p>
<div class="math notranslate nohighlight">
\[C_{N,s} = \max(0, S^f_{N,s})\]</div>
<p>The next cell demonstrates the terminal value of a European call option where the strike price is equal to the initial price (known as an ‘at the money’ strike).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Sf</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">K</span><span class="p">)</span>

<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">],[</span><span class="n">K</span><span class="p">,</span><span class="n">K</span><span class="p">],</span><span class="s1">&#39;y--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fc495061cd0&gt;]
</pre></div>
</div>
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_16_1.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_16_1.png" />
</div>
</div>
<p>To price a call option, consider the construction of a portfolio composed of the underlying asset and cash that would have the same payoff. At node <span class="math notranslate nohighlight">\(k,s\)</span>, the portfolio is given by</p>
<div class="math notranslate nohighlight">
\[C_{k,s} = x_{k,s}S^f_{k,s} + y_{k,s}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_{k,s}\)</span> is the number of units of the underlying asset, and <span class="math notranslate nohighlight">\(y_{k,s}\)</span> is the cash component of the portfolio. The subsequent value of the portfolio at <span class="math notranslate nohighlight">\(k+1\)</span> has two possible values</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
C_{k+1,s} &amp; = x_{k,s}uS^f_{k,s} + (1+r)y_{k,s} \\
C_{k+1,s+1} &amp; = x_{k,s}dS^f_{k,s} + (1+r)y_{k,s}
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the per period interest rate for cash. Solving for <span class="math notranslate nohighlight">\(x_{k,s}\)</span> and <span class="math notranslate nohighlight">\(y_{k,s}\)</span>,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
x_{k,s} &amp; = \frac{C_{k+1,s} - C_{k+1,s+1}}{(u-d)S^f_{k,s}} \\
y_{k,s} &amp; = \frac{uC_{k+1,s+1}-dC_{k+1,s}}{(1+r)(u-d)}
\end{align*}
\end{split}\]</div>
<p>Inserting these solutions into the original expression,</p>
<div class="math notranslate nohighlight">
\[C_{k,s} = \frac{(\left[(1+r) - d\right]C_{k+1,s} + \left[u - (1+r)\right]C_{k+1,s+1}}{(1+r)(u-d)}\]</div>
<p>This can be expressed in a far more suggestive form</p>
<div class="math notranslate nohighlight">
\[C_{k,s} = \frac{1}{1+r}\left[\underbrace{\frac{(1+r)-d}{u-d}}_{q}C_{k+1,s} + \underbrace{\frac{u-(1+r)}{u-d}}_{1-q}C_{k+1,s+1}\right]\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[C_{k,s} = \frac{1}{1+r}\left[q C_{k+1,s} + (1-q)C_{k+1,s+1}\right]\]</div>
<p>This expression has two important consequences. The first is an interpretation as a ‘risk-neutral’ probability such that <span class="math notranslate nohighlight">\(C_{k,s}\)</span> is the ‘expected value’ of the call option. This is not the real-world probability! Instead, it is different measure that provides a very useful means of computing the value of options as illustrated in the following diagram.</p>
<p><img alt="BinomialModel_Options.png" src="https://github.com/jckantor/ND-Pyomo-Cookbook/blob/master/notebooks/figures/BinomialModel_Options.png?raw=1" /></p>
<p>The second important consequence is the actual pricing formula. It’s linear, for one thing, is easily implemented as a calculation that proceeds backward in time as shown in the diagram above. As can be seen from the derivation, the computation is quite general and can be applied to any option which can be assigned a terminal value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">0.030</span><span class="o">/</span><span class="mi">12</span>
<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="n">d</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;q = &#39;</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>

<span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Sf</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">K</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span>
        <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span>

<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">],[</span><span class="n">K</span><span class="p">,</span><span class="n">K</span><span class="p">],</span><span class="s1">&#39;y--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Price of a Call Option&#39;</span><span class="p">)</span>

<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">],[</span><span class="n">K</span><span class="p">,</span><span class="n">K</span><span class="p">],</span><span class="s1">&#39;y--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Hedge Ratio&#39;</span><span class="p">)</span>

<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">],[</span><span class="n">K</span><span class="p">,</span><span class="n">K</span><span class="p">],</span><span class="s1">&#39;y--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cash Position&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>q =  0.49963641972465866
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Cash Position&#39;)
</pre></div>
</div>
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_18_2.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_18_2.png" />
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_18_3.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_18_3.png" />
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_18_4.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_18_4.png" />
</div>
</div>
</section>
<section id="implementing-a-replicating-portfolio-with-pyomo">
<h2><span class="section-number">8.4.3. </span>Implementing a replicating portfolio with Pyomo<a class="headerlink" href="#implementing-a-replicating-portfolio-with-pyomo" title="Permalink to this headline">#</a></h2>
<p>A replicating portfolio is the key concept that allows use of the binomial model for pricing options. In a nutshell, the value of an option is the money needed to construct a portfolio  exactly replicate the option payoff.</p>
<p>This concept can be extended to applications involving ‘real assets’, including processes that convert commodity resources into higher value products. As a first step, let’s see how Pyomo can be used to model a replicating portfolio for a European call option.</p>
<p>We start with an expression for the value of the replicating portfolio at time <span class="math notranslate nohighlight">\(k\)</span> in state <span class="math notranslate nohighlight">\(s\)</span>. For the purpose of later generalization, we use the symbol <span class="math notranslate nohighlight">\(W\)</span> to denote wealth,</p>
<div class="math notranslate nohighlight">
\[W_{k,s} = x_{k,s}S^f_{k,s} + y_{k,s}B_k\]</div>
<p>The portfolio consists of <span class="math notranslate nohighlight">\(x_{k,s}\)</span> units of an underlying asset with a price <span class="math notranslate nohighlight">\(S^f_{k,s}\)</span> subject to statistical variability, and <span class="math notranslate nohighlight">\(y_{k,s}\)</span> units of a ‘bond’ which has a known future price and therefore depends only on <span class="math notranslate nohighlight">\(k\)</span>. For example,</p>
<div class="math notranslate nohighlight">
\[B_k = (1 + r_f)^k B_0 \]</div>
<p>where <span class="math notranslate nohighlight">\(r_f\)</span> is a risk-free interest rate. This is the ‘cash’ component of the portfolio.</p>
<p>For a European call option we must have enough wealth on-hand to pay off the value of the call option at <span class="math notranslate nohighlight">\(k=N\)</span>. This requirement can be written as inequalities</p>
<div class="math notranslate nohighlight">
\[W_{N,s} \geq \max(0, S^f_{N,s} - K) \qquad \forall s\in{\cal S}_N \]</div>
<p>where <span class="math notranslate nohighlight">\({\cal S}_N\)</span> is the set of possible states at time step <span class="math notranslate nohighlight">\(N\)</span>.</p>
<p>At earlier nodes, the value of the portfolio must be sufficient to finance the portfolio as subsequent states. In the binomial model, for each node <span class="math notranslate nohighlight">\((k,s)\)</span> there are two subsequent states <span class="math notranslate nohighlight">\((k+1,s)\)</span> and <span class="math notranslate nohighlight">\((k+1,s+1)\)</span>. This results in two constraints:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
x_{k,s}S^f_{k+1,s} + y_{k,s}B_{k+1} &amp; \geq W_{k+1,s} \\
x_{k,s}S^f_{k+1,s+1} + y_{k,s}B_{k+1} &amp; \geq W_{k+1,s+1}
\end{align*}
\end{split}\]</div>
<p>What we seek is the minimum cost portfolio at the initial node, i.e.,</p>
<div class="math notranslate nohighlight">
\[\min_{x,y} W_{0,0}\]</div>
<p>subject to the above constraints.</p>
<p>If everything works as expected, the results of this calculation should be the same as those computed using risk-neutral probabilities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mi">200</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set of periods and states for each period</span>
<span class="n">Periods</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">States</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># future bond prices</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Periods</span><span class="p">]</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>

<span class="c1"># model variables</span>
<span class="n">m</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>

<span class="c1"># objective</span>
<span class="n">m</span><span class="o">.</span><span class="n">OBJ</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>

<span class="c1"># constraint list</span>
<span class="n">m</span><span class="o">.</span><span class="n">cons</span> <span class="o">=</span> <span class="n">ConstraintList</span><span class="p">()</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Periods</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">States</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Sf</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">K</span><span class="p">))</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

<span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;glpk&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">W</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]()</span>
        
<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">W</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Value of a European Call Option&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Value of a European Call Option&#39;)
</pre></div>
</div>
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_21_1.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_21_1.png" />
</div>
</div>
</section>
<section id="european-put-option">
<h2><span class="section-number">8.4.4. </span>European put option<a class="headerlink" href="#european-put-option" title="Permalink to this headline">#</a></h2>
<p>A European put option is the right (without obligation) to sell an asset for specified price on a specified date. The analysis is proceeds exactly as for the European call option, except that the value on the terminal date is given by</p>
<div class="math notranslate nohighlight">
\[P_{N,s} = \max(0, K-S^f_{N,s}) \qquad \forall s\in{\cal S}_N \]</div>
<p>The value of the put option can be computed using the same risk neutral probabilities as for the call option, or by modifying the Pyomo model as shown in the following cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set of periods and states for each period</span>
<span class="n">Periods</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">States</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># future bond prices</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Periods</span><span class="p">]</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>

<span class="c1"># model variables</span>
<span class="n">m</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>

<span class="c1"># objective</span>
<span class="n">m</span><span class="o">.</span><span class="n">OBJ</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>

<span class="c1"># constraint list</span>
<span class="n">m</span><span class="o">.</span><span class="n">cons</span> <span class="o">=</span> <span class="n">ConstraintList</span><span class="p">()</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Periods</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">States</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">K</span> <span class="o">-</span> <span class="n">Sf</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">s</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

<span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;glpk&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">W</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]()</span>
        
<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">W</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Value of European Put Option&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Value of European Put Option&#39;)
</pre></div>
</div>
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_23_1.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_23_1.png" />
</div>
</div>
</section>
<section id="early-exercise">
<h2><span class="section-number">8.4.5. </span>Early exercise<a class="headerlink" href="#early-exercise" title="Permalink to this headline">#</a></h2>
<p>Let’s compare the value of the put option to the value of exercising the option. At any node <span class="math notranslate nohighlight">\((k,s)\)</span>, the value of exercising the option is <span class="math notranslate nohighlight">\(K-S^f_{k,s}\)</span>. The next cell compares the value of the European put option to hypothetical value of early exercise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]()</span>
        
<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">W</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Value of European Put Option&#39;</span><span class="p">)</span>

<span class="n">E</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">E</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span> <span class="o">-</span> <span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span>
        
<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">E</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The hypothetical value of early exercise of European Put Option&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;The hypothetical value of early exercise of European Put Option&#39;)
</pre></div>
</div>
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_25_1.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_25_1.png" />
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_25_2.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_25_2.png" />
</div>
</div>
<p>We see several nodes where the value of exercising the option is worth more than the option itself. These would be opportunities for a risk-free profit. If such a circumstance arises, then</p>
<ol class="simple">
<li><p>buy the put option at price <span class="math notranslate nohighlight">\(P_{k,s}\)</span></p></li>
<li><p>buy the asset at price <span class="math notranslate nohighlight">\(S^f_{k,s}\)</span></p></li>
<li><p>exercise the option to sell at the strike price <span class="math notranslate nohighlight">\(K\)</span></p></li>
</ol>
<p>If <span class="math notranslate nohighlight">\(K &gt; P_{k,s} + S^f_{k,s}\)</span> then this deal offers a completely risk-free profit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Arbitrage</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Arbitrage</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">K</span> <span class="o">-</span> <span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]()))</span>
        
<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">Arbitrage</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Arbitrage value for early exercise of a European Put Option&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Arbitrage value for early exercise of a European Put Option&#39;)
</pre></div>
</div>
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_27_1.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_27_1.png" />
</div>
</div>
</section>
<section id="american-put-option">
<h2><span class="section-number">8.4.6. </span>American put option<a class="headerlink" href="#american-put-option" title="Permalink to this headline">#</a></h2>
<p>Compared to a European option, an American option provides an additional right of early exercise. The holder of the option an choose to exercise the option at any point prior to the expiration date.  This additional right can (but does not always add value under certain conditions.</p>
<p>The opportunity for early exercise adds some complexity to the calculation of value. In the optimization framework, the holder of an American put could always receive value by exercising the option if the market value of the option is less than the exercise value.  Thus the exercise value establishes a lower bound on the value of the option at all nodes (not just the terminal nodes)</p>
<div class="math notranslate nohighlight">
\[P_{k,s} \geq K - S^f_{k,s}\]</div>
<p>This is demonstrated in the following cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set of periods and states for each period</span>
<span class="n">Periods</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">States</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># future bond prices</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Periods</span><span class="p">]</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>

<span class="c1"># model variables</span>
<span class="n">m</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">Periods</span><span class="p">,</span><span class="n">States</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">)</span>

<span class="c1"># objective</span>
<span class="n">m</span><span class="o">.</span><span class="n">OBJ</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>

<span class="c1"># constraint list</span>
<span class="n">m</span><span class="o">.</span><span class="n">cons</span> <span class="o">=</span> <span class="n">ConstraintList</span><span class="p">()</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Periods</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Periods</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">K</span> <span class="o">-</span> <span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

<span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;glpk&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">W</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">E</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]()</span>
        <span class="n">E</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="n">Sf</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">s</span><span class="p">]())</span> <span class="o">&lt;</span> <span class="mf">0.01</span>
        
<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">W</span><span class="p">)</span>

<span class="n">SPdisplay</span><span class="p">(</span><span class="n">Sf</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">E</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_29_0.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_29_0.png" />
<img alt="../_images/08.03-Binomial-Model-for-Pricing-Options_29_1.png" src="../_images/08.03-Binomial-Model-for-Pricing-Options_29_1.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="08.02-Consolidating-and-Charting-Stock-Data.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">8.2. </span>Consolidating and Charting Stock Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="08.04-MAD-Portfolio-Optimization.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8.5. </span>MAD Portfolio Optimization</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Jeffrey C. Kantor<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>